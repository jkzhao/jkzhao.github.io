<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  
    
      
    

    
  

  

  
    
      
    

    
  

  
    
      
    

    
  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Lobster Two:300,300italic,400,400italic,700,700italic|consolas:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Kubernetes," />





  <link rel="alternate" href="/atom.xml" title="jkzhao's blog" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico?v=5.0.1" />






<meta name="description" content="两种特殊的存储卷:configMap和secret123456[root@spark32 manifests]# kubectl explain pods.spec.volumes   configMap    &amp;lt;Object&amp;gt;     ConfigMap represents a configMap that should populate this volume   secret">
<meta name="keywords" content="Kubernetes">
<meta property="og:type" content="article">
<meta property="og:title" content="Kubernetes configMap和secret">
<meta property="og:url" content="http://yoursite.com/2019/08/28/Kubernetes-configmap和secret/index.html">
<meta property="og:site_name" content="jkzhao&#39;s blog">
<meta property="og:description" content="两种特殊的存储卷:configMap和secret123456[root@spark32 manifests]# kubectl explain pods.spec.volumes   configMap    &amp;lt;Object&amp;gt;     ConfigMap represents a configMap that should populate this volume   secret">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/Kubernetes/154.png">
<meta property="og:image" content="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/Kubernetes/155.png">
<meta property="og:image" content="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/Kubernetes/156.png">
<meta property="og:image" content="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/Kubernetes/157.png">
<meta property="og:image" content="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/Kubernetes/158.png">
<meta property="og:image" content="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/Kubernetes/159.png">
<meta property="og:image" content="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/Kubernetes/160.png">
<meta property="og:image" content="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/Kubernetes/161.png">
<meta property="og:image" content="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/Kubernetes/162.png">
<meta property="og:updated_time" content="2019-08-29T02:46:23.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Kubernetes configMap和secret">
<meta name="twitter:description" content="两种特殊的存储卷:configMap和secret123456[root@spark32 manifests]# kubectl explain pods.spec.volumes   configMap    &amp;lt;Object&amp;gt;     ConfigMap represents a configMap that should populate this volume   secret">
<meta name="twitter:image" content="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/Kubernetes/154.png">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 6287775856811050000,
      author: 'Author'
    }
  };
</script>

  <title> Kubernetes configMap和secret | jkzhao's blog </title>
</head>
<a href="https://github.com/you"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/38ef81f8aca64bb9a64448d0d70f1308ef5341ab/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6461726b626c75655f3132313632312e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"></a>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?c179eb46ac47d3b4b1b9203b82ee5821";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>








  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <a href="https://github.com/jkzhao"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/38ef81f8aca64bb9a64448d0d70f1308ef5341ab/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6461726b626c75655f3132313632312e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"></a>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">jkzhao's blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">学习 总结 思考</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-guestbook">
          <a href="/guestbook" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            留言
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="#" class="st-search-show-outputs">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <form class="site-search-form">
  <input type="text" id="st-search-input" class="st-search-input st-default-search-input" />
</form>

<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
    (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
    e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install', 'CziK4aDdRyzFJrfygnHH','2.0.0');
</script>



    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Kubernetes configMap和secret
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2019-08-28T15:54:17+08:00" content="2019-08-28">
              2019-08-28
            </time>
            
              <span class="post-updated">
              &nbsp; | &nbsp; 更新于
              <time itemprop="dateUpdated" datetime="2019-08-29T10:46:23+08:00" content="2019-08-29">
              2019-08-29
              </time>
              </span>
            
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/容器编排/" itemprop="url" rel="index">
                    <span itemprop="name">容器编排</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/容器编排/Kubernetes/" itemprop="url" rel="index">
                    <span itemprop="name">Kubernetes</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          
             <span id="/2019/08/28/Kubernetes-configmap和secret/" class="leancloud_visitors" data-flag-title="Kubernetes configMap和secret">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="两种特殊的存储卷-configMap和secret"><a href="#两种特殊的存储卷-configMap和secret" class="headerlink" title="两种特殊的存储卷:configMap和secret"></a>两种特殊的存储卷:configMap和secret</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[root@spark32 manifests]# kubectl explain pods.spec.volumes</div><div class="line">   configMap    &lt;Object&gt;</div><div class="line">     ConfigMap represents a configMap that should populate this volume</div><div class="line">   secret       &lt;Object&gt;</div><div class="line">     Secret represents a secret that should populate this volume. More info:</div><div class="line">     https://kubernetes.io/docs/concepts/storage/volumes#secret</div></pre></td></tr></table></figure>
<a id="more"></a>
<p>这两种存储卷多数情况下，它们的目的不是给Pod提供存储空间来用的，而是给我们的管理员或用户提供了从集群外部向Pod内部的应用程序注入配置信息的方式。<br>第一点，比如在集群上，有个名称空间，在这个名称空间之上，有个Pod在运行。我们启动Pod是基于镜像来运行容器的。镜像做好后，镜像内的应用程序启动时要读配置文件也是镜像内的配置文件，因此镜像内的应用启动时到底应该运行在什么配置下，在做镜像之前就确定了。做完镜像后就改不了了。除非用entrypoint脚本，去接受用户启动容器时传一些环境变量进来。把环境变量中的数据给他写到或替换到配置文件中去从而使得应用程序在启动之前就获得一个新的配置文件，而后得到新配置。否则会有个问题，做好了的镜像，它可能为了适用不同的部署方式或者不同的环境，需要做很多个镜像。比如开发、测试、线上，三套环境都要部署tomcat，但是使用的内存大小不一样，很显然我们把配置写在配置文件之中，三个环境不可能都适用的，所以不得不做三个镜像，这很麻烦。所以后来想了其他办法来解决这个配置信息的注入。在k8s上也是如此，本来镜像都是做好的，一个镜像应付不了那么多场景，就不得不做多个镜像，这个特别难受，所以能够从镜像外部向镜像内部启动为容器时给它添加配置信息，是很重要的。<br>第二点，假如现在部署了20个Pod，里面都是tomcat，就算我们能够从外部通过环境变量注入进去，但是运行了一段时间以后，需要改配置参数，怎么改？重新替换环境变量的值。但是entrypoint已经生过效了。你可能还要触发entrypoint脚本重新执行一次，甚至是Pod不用动，把里面容器重启下。这个过程其实是比较麻烦的，而且还得一个一个去操作，一个一个重新改环境变量的值。应用程序运行时，有一种简单地方式来实现这个功能，可以使用配置中心。把配置放在配置中心，tomcat启动时加载的文件，文件看起来存在，可能并没有内容，文件来自于配置中心，动态从配置中心拉过来，然后启动tomcat。将来在配置中心修改配置，并通知给进程，让这些进程重载配置文件。k8s也面临一样的场景，这20个Pod需要更新的时候，改配置只能通过改镜像的话，代价太大了。因此我们不把配置写死在镜像中，而是引入一个新的资源，这个新的资源甚至是整个k8s之上的一等公民，这个资源就叫<strong>configMap</strong>，它里面放的是配置信息。随后启动的每一个Pod时，都可以共享使用同一个configMap资源。这个资源对象可以当存储卷来使用，也可以从中基于环境变量的方式从里面获取到一些数据传递给环境变量从而注入到容器中使用。<br>总结下来，有两种较为合适的方式去解决以上出现的两个场景：</p>
<ul>
<li>1、假如现在要启动一个Pod，这个Pod启动时可以把configmap资源关联到当前Pod上来，从中读一个数据，传递给Pod内容器中的一个变量，仍然是变量注入的方式来给容器传递配置信息。</li>
<li>2、把每一个configmap当一个存储卷，直接挂载到容器中的某个目录上，这个目录恰好是应用程序读取配置信息的文件路径。而且支持动态修改，意思是说如果configmap中内容修改下，改完后会通知给所有的Pod，让Pod里面的应用重载，当然有些应用可能不能自动重载，你需要手动触发下重载。因此configmap扮演了k8s之上的配置中心的功能。</li>
</ul>
<p>所以要想传一个配置文件给Pod中的容器，可以把配置文件打包在configmap中，让Pod启动时把configmap挂载到配置文件目录下，就从这下面读配置文件就能ok了。但是configmap是明文存数据的，因此在里面放的各种配置文件，不能包含敏感数据，比如连mysql，不能放root账号。跟configmap有些同样功能的另外一个标准k8s资源叫<strong>secret</strong>。secret的功能和configmap功能一样，所不同的是其中的内容不是明文存放的，而是base64编码存放的。不是加密，很容易解开，但是至少对很多人来讲，是不可为的任务了。</p>
<p><strong>先做一个总结：配置容器化应用的方式：</strong></p>
<ul>
<li>1、自定义命令行参数;<br>args: [] </li>
<li>2、把配置文件直接放进镜像;<br>不建议，这是在用dockerfile制作镜像时就把配置文件放进去了</li>
<li>3、环境变量<br>(1) Cloud Native的应用程序一般可直接通过环境变量加载配置;<br>(2) 通过entrypoint脚本来预处理变量为配置文件中的配置信息，通过SET命令之类的替换到配置文件中去；</li>
<li>4、存储卷</li>
</ul>
<h2 id="Pod资源获取环境变量的方式：env、envFrom"><a href="#Pod资源获取环境变量的方式：env、envFrom" class="headerlink" title="Pod资源获取环境变量的方式：env、envFrom"></a>Pod资源获取环境变量的方式：env、envFrom</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">[root@spark32 manifests]# kubectl explain pods.spec.containers.env</div><div class="line">...</div><div class="line">name &lt;string&gt; -required-</div><div class="line">     Name of the environment variable. Must be a C_IDENTIFIER.</div><div class="line"></div><div class="line">   value        &lt;string&gt;</div><div class="line">     Variable references $(VAR_NAME) are expanded using the previous defined</div><div class="line">     environment variables in the container and any service environment</div><div class="line">     variables. If a variable cannot be resolved, the reference in the input</div><div class="line">     string will be unchanged. The $(VAR_NAME) syntax can be escaped with a</div><div class="line">     double $$, ie: $$(VAR_NAME). Escaped references will never be expanded,</div><div class="line">     regardless of whether the variable exists or not. Defaults to &quot;&quot;.</div><div class="line"></div><div class="line">   valueFrom    &lt;Object&gt;</div><div class="line">     Source for the environment variable&apos;s value. Cannot be used if value is not</div><div class="line">     empty.</div><div class="line">...</div></pre></td></tr></table></figure>
<ul>
<li>valueFrom: 数据来自引用另外一个变量或另外一个对象</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">[root@spark32 manifests]# kubectl explain pods.spec.containers.env.valueFrom</div><div class="line">...</div><div class="line">FIELDS:</div><div class="line">   configMapKeyRef      &lt;Object&gt;</div><div class="line">     Selects a key of a ConfigMap.</div><div class="line"></div><div class="line">   fieldRef     &lt;Object&gt;</div><div class="line">     Selects a field of the pod: supports metadata.name, metadata.namespace,</div><div class="line">     metadata.labels, metadata.annotations, spec.nodeName,</div><div class="line">     spec.serviceAccountName, status.hostIP, status.podIP.</div><div class="line"></div><div class="line">   resourceFieldRef     &lt;Object&gt;</div><div class="line">     Selects a resource of the container: only resources limits and requests</div><div class="line">     (limits.cpu, limits.memory, limits.ephemeral-storage, requests.cpu,</div><div class="line">     requests.memory and requests.ephemeral-storage) are currently supported.</div><div class="line"></div><div class="line">   secretKeyRef &lt;Object&gt;</div><div class="line">     Selects a key of a secret in the pod&apos;s namespace</div><div class="line">...</div></pre></td></tr></table></figure>
<ul>
<li>configMapKeyRef: 在configMap中的某个key的vlaue，configMap也是键值对。</li>
<li>fieldRef: 某个字段，这个字段很可能是Pod自身的字段，比如像metadata.labels, metadata.annotations, spec.nodeName, spec.serviceAccountName, status.hostIP, status.podIP.</li>
<li>resourceFieldRef: 资源需求和资源算法，后面讲到调度器算法时在解释</li>
<li>secretKeyRef: 引用secretKey</li>
</ul>
<h2 id="configMap"><a href="#configMap" class="headerlink" title="configMap"></a>configMap</h2><p>简称cm。<br><strong>configMap作用：</strong>让配置信息与镜像文件解耦。从而增强了应用的可移植性以及可复用性。configMap就是一系列配置数据的集合，而这些数据将来可以注入到Pod中的容器中所使用。<br>在configMap中，所有的配置信息都保存为键值格式。比如name: zhangshan。但是这种格式保存的数据量很小，我们也可以保存为比较复杂的格式。比如键名叫server.conf, 值是曾经在Nginx上配置时传递的这个server的整个内容。可以是整个文件的所有内容。因为value的长度是没有限制的。<br>configMap是一等公民，属于名称空间的资源，但是它的字段比较独特，和之前所学的Pod、Service等都不一样。没有spec，因为它没有那么复杂的结构，不需要嵌套众多状态描述的属性或字段。只需要给数据就可以了，所以有个data字段，是个map类型的。也可以以二进制形式给数据。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">[root@spark32 manifests]# kubectl explain cm</div><div class="line">KIND:     ConfigMap</div><div class="line">VERSION:  v1</div><div class="line"></div><div class="line">DESCRIPTION:</div><div class="line">     ConfigMap holds configuration data for pods to consume.</div><div class="line"></div><div class="line">FIELDS:</div><div class="line">   apiVersion   &lt;string&gt;</div><div class="line">     APIVersion defines the versioned schema of this representation of an</div><div class="line">     object. Servers should convert recognized schemas to the latest internal</div><div class="line">     value, and may reject unrecognized values. More info:</div><div class="line">     https://git.k8s.io/community/contributors/devel/api-conventions.md#resources</div><div class="line"></div><div class="line">   binaryData   &lt;map[string]string&gt;</div><div class="line">     BinaryData contains the binary data. Each key must consist of alphanumeric</div><div class="line">     characters, &apos;-&apos;, &apos;_&apos; or &apos;.&apos;. BinaryData can contain byte sequences that are</div><div class="line">     not in the UTF-8 range. The keys stored in BinaryData must not overlap with</div><div class="line">     the ones in the Data field, this is enforced during validation process.</div><div class="line">     Using this field will require 1.10+ apiserver and kubelet.</div><div class="line"></div><div class="line">   data &lt;map[string]string&gt;</div><div class="line">     Data contains the configuration data. Each key must consist of alphanumeric</div><div class="line">     characters, &apos;-&apos;, &apos;_&apos; or &apos;.&apos;. Values with non-UTF-8 byte sequences must use</div><div class="line">     the BinaryData field. The keys stored in Data must not overlap with the</div><div class="line">     keys in the BinaryData field, this is enforced during validation process.</div><div class="line"></div><div class="line">   kind &lt;string&gt;</div><div class="line">     Kind is a string value representing the REST resource this object</div><div class="line">     represents. Servers may infer this from the endpoint the client submits</div><div class="line">     requests to. Cannot be updated. In CamelCase. More info:</div><div class="line">     https://git.k8s.io/community/contributors/devel/api-conventions.md#types-kinds</div><div class="line"></div><div class="line">   metadata     &lt;Object&gt;</div><div class="line">     Standard object&apos;s metadata. More info:</div><div class="line">     https://git.k8s.io/community/contributors/devel/api-conventions.md#metadata</div></pre></td></tr></table></figure></p>
<p>data和binaryData，一般只使用其中一种。<br>定义configMap时，可以使用yaml文件，也可以在命令行使用kubectl create configmap来定义。如果需要长期使用，可以定义成yaml文件来保存。</p>
<h2 id="configMap示例"><a href="#configMap示例" class="headerlink" title="configMap示例"></a>configMap示例</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line">[root@spark32 manifests]# kubectl create configmap -h</div><div class="line">...</div><div class="line">Examples:</div><div class="line">  # Create a new configmap named my-config based on folder bar</div><div class="line">  kubectl create configmap my-config --from-file=path/to/bar</div><div class="line">  </div><div class="line">  # Create a new configmap named my-config with specified keys instead of file basenames on disk</div><div class="line">  kubectl create configmap my-config --from-file=key1=/path/to/bar/file1.txt --from-file=key2=/path/to/bar/file2.txt</div><div class="line">  </div><div class="line">  # Create a new configmap named my-config with key1=config1 and key2=config2</div><div class="line">  kubectl create configmap my-config --from-literal=key1=config1 --from-literal=key2=config2</div><div class="line">  </div><div class="line">  # Create a new configmap named my-config from the key=value pairs in the file</div><div class="line">  kubectl create configmap my-config --from-file=path/to/bar</div><div class="line">  </div><div class="line">  # Create a new configmap named my-config from an env file</div><div class="line">  kubectl create configmap my-config --from-env-file=path/to/bar.env</div><div class="line"></div><div class="line">Options:</div><div class="line">      --allow-missing-template-keys=true: If true, ignore any errors in templates when a field or map key is missing in</div><div class="line">the template. Only applies to golang and jsonpath output formats.</div><div class="line">      --append-hash=false: Append a hash of the configmap to its name.</div><div class="line">      --dry-run=false: If true, only print the object that would be sent, without sending it.</div><div class="line">      --from-env-file=&apos;&apos;: Specify the path to a file to read lines of key=val pairs to create a configmap (i.e. a Docker</div><div class="line">.env file).</div><div class="line">      --from-file=[]: Key file can be specified using its file path, in which case file basename will be used as</div><div class="line">configmap key, or optionally with a key and file path, in which case the given key will be used.  Specifying a directory</div><div class="line">will iterate each named file in the directory whose basename is a valid configmap key.</div><div class="line">      --from-literal=[]: Specify a key and literal value to insert in configmap (i.e. mykey=somevalue)</div><div class="line">      --generator=&apos;configmap/v1&apos;: The name of the API generator to use.</div><div class="line">  -o, --output=&apos;&apos;: Output format. One of:</div><div class="line">json|yaml|name|go-template|go-template-file|template|templatefile|jsonpath|jsonpath-file.</div><div class="line">      --save-config=false: If true, the configuration of current object will be saved in its annotation. Otherwise, the</div><div class="line">annotation will be unchanged. This flag is useful when you want to perform kubectl apply on this object in the future.</div><div class="line">      --template=&apos;&apos;: Template string or path to template file to use when -o=go-template, -o=go-template-file. The</div><div class="line">template format is golang templates [http://golang.org/pkg/text/template/#pkg-overview].</div><div class="line">      --validate=true: If true, use a schema to validate the input before sending it</div><div class="line"></div><div class="line">Usage:</div><div class="line">  kubectl create configmap NAME [--from-file=[key=]source] [--from-literal=key1=value1] [--dry-run] [options]</div></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/Kubernetes/154.png" alt=""></p>
<p><strong>【示例1】：把键值做成configMap。</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">[root@spark32 manifests]# kubectl create configmap nginx-config --from-literal=nginx_port=80 --from-literal=server_name=myapp.wisedu.com</div><div class="line">configmap/nginx-config created</div><div class="line">[root@spark32 manifests]# kubectl get cm</div><div class="line">NAME           DATA   AGE</div><div class="line">nginx-config   2      28s</div><div class="line">[root@spark32 manifests]# kubectl describe cm nginx-config</div><div class="line">Name:         nginx-config</div><div class="line">Namespace:    default</div><div class="line">Labels:       &lt;none&gt;</div><div class="line">Annotations:  &lt;none&gt;</div><div class="line"></div><div class="line">Data</div><div class="line">====</div><div class="line">nginx_port:</div><div class="line">----</div><div class="line">80</div><div class="line">server_name:</div><div class="line">----</div><div class="line">myapp.wisedu.com</div><div class="line">Events:  &lt;none&gt;</div></pre></td></tr></table></figure></p>
<p>可以看出，直接就可以看到configMap中的内容了。</p>
<p><strong>【示例2】：把一个文件内容做成configMap。</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">[root@spark32 manifests]# mkdir configmap</div><div class="line">[root@spark32 manifests]# cd configmap/</div><div class="line">[root@spark32 configmap]# vim www.conf</div><div class="line">server &#123;</div><div class="line">    server_name myapp.wisedu.com;</div><div class="line">    listen 80;</div><div class="line">    root /data/web/html;</div><div class="line">&#125;</div><div class="line">[root@spark32 configmap]# kubectl create cm nginx-www --from-file=./www.conf</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">[root@spark32 configmap]# kubectl create cm nginx-www --from-file=./www.conf  </div><div class="line">configmap/nginx-www created</div><div class="line">[root@spark32 configmap]# kubectl describe cm nginx-www</div><div class="line">Name:         nginx-www</div><div class="line">Namespace:    default</div><div class="line">Labels:       &lt;none&gt;</div><div class="line">Annotations:  &lt;none&gt;</div><div class="line"></div><div class="line">Data</div><div class="line">====</div><div class="line">www.conf:</div><div class="line">----</div><div class="line">server &#123;</div><div class="line">    server_name myapp.wisedu.com;</div><div class="line">    listen 80;</div><div class="line">    root /data/web/html;</div><div class="line">&#125;</div><div class="line"></div><div class="line">Events:  &lt;none&gt;</div></pre></td></tr></table></figure>
<p><strong>configmap两种方式注入容器中：</strong></p>
<ul>
<li>1.在容器中使用env，使用envFrom来获取。<br>如果通过环境变量来注入的话，必须确保环境变量传递进去能被容器作为配置信息使用，否则传过去没用。而两种方式上面提了，cloudnative，可直接通过环境变量加载配置，要不就是通过entrypoint脚本来处理。所以不是云环境，得在容器里写了entrypoint脚本才能使用传递进来的环境变量。</li>
<li>2.存储卷方式</li>
</ul>
<p><strong>【示例3】：使用env来传递环境变量</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">[root@spark32 manifests]# kubectl explain pods.spec.containers.env.valueFrom.configMapKeyRef</div><div class="line">KIND:     Pod</div><div class="line">VERSION:  v1</div><div class="line"></div><div class="line">RESOURCE: configMapKeyRef &lt;Object&gt;</div><div class="line"></div><div class="line">DESCRIPTION:</div><div class="line">     Selects a key of a ConfigMap.</div><div class="line"></div><div class="line">     Selects a key from a ConfigMap.</div><div class="line"></div><div class="line">FIELDS:</div><div class="line">   key  &lt;string&gt; -required-</div><div class="line">     The key to select.</div><div class="line"></div><div class="line">   name &lt;string&gt;</div><div class="line">     Name of the referent. More info:</div><div class="line">     https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names</div><div class="line"></div><div class="line">   optional     &lt;boolean&gt;</div><div class="line">     Specify whether the ConfigMap or it&apos;s key must be defined</div></pre></td></tr></table></figure></p>
<ul>
<li>optional: 如果在容器中定义了从configmap引用，万一没有这个configmap，或者configmap中没有这个key，pod就启动不了了，因为引用数据不存在，会出错的。但是我们可以optional这一项启用起来，optional: true。意思是可选的，就算没有也没关系，如果不写为true，就表示must be defined。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">[root@spark32 configmap]# vim pod-configmap.yaml</div><div class="line">apiVersion: v1</div><div class="line">kind: Pod</div><div class="line">metadata:</div><div class="line">  name: pod-cm-1</div><div class="line">  namespace: default</div><div class="line">  labels:</div><div class="line">    app: myapp</div><div class="line">    tier: frontend</div><div class="line">  annotations:</div><div class="line">    wisedu.com/created-by: &quot;cluster admin&quot;</div><div class="line">spec:</div><div class="line">  containers:</div><div class="line">  - name: myapp</div><div class="line">    image: ikubernetes/myapp:v1</div><div class="line">    ports:</div><div class="line">    - name: http</div><div class="line">      containerPort: 80</div><div class="line">    env:</div><div class="line">    - name: NGINX_SERVER_PORT</div><div class="line">      valueFrom:</div><div class="line">        configMapKeyRef:</div><div class="line">          name: nginx-config</div><div class="line">          key: nginx_port</div><div class="line">    - name: NGINX_SERVER_NAME</div><div class="line">      valueFrom:</div><div class="line">        configMapKeyRef:</div><div class="line">          name: nginx-config</div><div class="line">          key: server_name</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">[root@spark32 configmap]# kubectl apply -f pod-configmap.yaml </div><div class="line">pod/pod-cm-1 created</div><div class="line">[root@spark32 configmap]# kubectl get pods</div><div class="line">NAME                             READY   STATUS    RESTARTS   AGE</div><div class="line">busybox                          0/1     Error     0          12d</div><div class="line">myapp-deploy-67b6dfcd8-ff9xf     1/1     Running   0          12d</div><div class="line">myapp-deploy-67b6dfcd8-msv5x     1/1     Running   0          12d</div><div class="line">myapp-deploy-67b6dfcd8-wls6h     1/1     Running   0          12d</div><div class="line">myapp-pod                        1/1     Running   0          24h</div><div class="line">nginx                            1/1     Running   0          12d</div><div class="line">pod-cm-1                         1/1     Running   0          5s</div><div class="line">pod-vol-pvc                      1/1     Running   0          25h</div><div class="line">redis-58b9f5776-fzslw            1/1     Running   0          9d</div><div class="line">tomcat-deploy-56699db4f7-4lhql   1/1     Running   0          6d6h</div><div class="line">tomcat-deploy-56699db4f7-ghz7l   1/1     Running   0          6d6h</div><div class="line">tomcat-deploy-56699db4f7-kd5v8   1/1     Running   0          6d6h</div><div class="line">[root@spark32 configmap]# kubectl exec -it pod-cm-1 -- printenv</div><div class="line">PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</div><div class="line">HOSTNAME=pod-cm-1</div><div class="line">TERM=xterm</div><div class="line">NGINX_SERVER_PORT=80</div><div class="line">NGINX_SERVER_NAME=myapp.wisedu.com</div><div class="line">MYAPP_SVC_SERVICE_HOST=10.111.183.73</div><div class="line">KUBERNETES_SERVICE_HOST=10.96.0.1</div><div class="line">REDIS_SERVICE_HOST=10.97.97.97</div><div class="line">...</div></pre></td></tr></table></figure>
<p>已经传进来了。<br>现在修改configmap中的key的value，看Pod中容器中的变量是否会及时生效。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@spark32 configmap]# kubectl edit cm nginx-config</div></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/Kubernetes/155.png" alt=""><br>查看Pod容器中变量是否发生变化：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@spark32 configmap]# kubectl exec -it pod-cm-1 -- printenv | grep NGINX_SERVER_PORT</div><div class="line">NGINX_SERVER_PORT=80</div></pre></td></tr></table></figure></p>
<p>实践证明修改 ConfigMap 无法更新容器中已注入的环境变量信息。<br><strong>当我们使用环境变量注入时，只在容器启动时有效。因为它是Pod创建时获取的。如果通过存储卷的方式来获取，是可以实时更新的。见下面的实例</strong></p>
<p><strong>【示例4】：使用存储卷来传递环境变量。</strong><br>configmap无论创建时是不是文件，比如在命令行指了个key，指了个value，我们可以把整个configmap当存储卷挂载到Pod上，然后yaml文件中指定容器把存储卷挂载到自己的某个目录下(挂载点不存在会自动创建)。在这个挂载目录下，每一个key就转换成一个文件名，那个key的value就转换成文件内容。以刚才在命令行创建的configmap nginx-config为例。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@spark32 configmap]# kubectl delete -f pod-configmap.yaml </div><div class="line">pod &quot;pod-cm-1&quot; deleted</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">[root@spark32 configmap]# vim pod-configmap-volume.yaml </div><div class="line">apiVersion: v1</div><div class="line">kind: Pod</div><div class="line">metadata:</div><div class="line">  name: pod-cm-vol</div><div class="line">  namespace: default</div><div class="line">  labels:</div><div class="line">    app: myapp</div><div class="line">    tier: frontend</div><div class="line">  annotations:</div><div class="line">    wisedu.com/created-by: &quot;cluster admin&quot;</div><div class="line">spec:</div><div class="line">  containers:</div><div class="line">  - name: myapp</div><div class="line">    image: ikubernetes/myapp:v1</div><div class="line">    ports:</div><div class="line">    - name: http</div><div class="line">      containerPort: 80</div><div class="line">    volumeMounts:</div><div class="line">    - name: nginxconf</div><div class="line">      mountPath: /etc/nginx/config.d/</div><div class="line">      readOnly: true</div><div class="line">  volumes:</div><div class="line">  - name: nginxconf</div><div class="line">    configMap:</div><div class="line">      name: nginx-config</div></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/Kubernetes/156.png" alt=""><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">[root@spark32 configmap]# kubectl apply -f pod-configmap-volume.yaml </div><div class="line">pod/pod-cm-vol created</div><div class="line">[root@spark32 configmap]# kubectl get pods</div><div class="line">NAME                             READY   STATUS    RESTARTS   AGE</div><div class="line">busybox                          0/1     Error     0          12d</div><div class="line">myapp-deploy-67b6dfcd8-ff9xf     1/1     Running   0          12d</div><div class="line">myapp-deploy-67b6dfcd8-msv5x     1/1     Running   0          12d</div><div class="line">myapp-deploy-67b6dfcd8-wls6h     1/1     Running   0          12d</div><div class="line">myapp-pod                        1/1     Running   0          24h</div><div class="line">nginx                            1/1     Running   0          12d</div><div class="line">pod-cm-vol                       1/1     Running   0          13s</div><div class="line">pod-vol-pvc                      1/1     Running   0          26h</div><div class="line">redis-58b9f5776-fzslw            1/1     Running   0          9d</div><div class="line">tomcat-deploy-56699db4f7-4lhql   1/1     Running   0          6d7h</div><div class="line">tomcat-deploy-56699db4f7-ghz7l   1/1     Running   0          6d7h</div><div class="line">tomcat-deploy-56699db4f7-kd5v8   1/1     Running   0          6d7h</div><div class="line">[root@spark32 configmap]# kubectl exec -it pod-cm-vol -- /bin/sh</div><div class="line">/ # cd /etc/nginx/config.d</div><div class="line">/etc/nginx/config.d # ls</div><div class="line">nginx_port   server_name</div><div class="line">/etc/nginx/config.d # ls -l</div><div class="line">total 0</div><div class="line">lrwxrwxrwx    1 root     root            17 Aug 28 09:44 nginx_port -&gt; ..data/nginx_port</div><div class="line">lrwxrwxrwx    1 root     root            18 Aug 28 09:44 server_name -&gt; ..data/server_name</div><div class="line">/etc/nginx/config.d # cat nginx_port </div><div class="line">/etc/nginx/config.d # cat server_name </div><div class="line">myapp.wisedu.com/etc/nginx/config.d #</div></pre></td></tr></table></figure></p>
<p>现在去修改下cm中的key的value：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@spark32 configmap]# kubectl edit cm nginx-config</div></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/Kubernetes/157.png" alt=""><br>在容器中查看这个变量：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">/etc/nginx/config.d # cat nginx_port </div><div class="line">8088/etc/nginx/config.d #</div></pre></td></tr></table></figure></p>
<p>需要稍微等下，因为这个修改要同步到apiserver中，apiserver在同步到Pod上。时间取决于apiserver同步速度。这里实测大概10秒才能同步更新。<br>其实这两个文件是链接文件，不是同步进来的，这两个文件本来就是访问原来的文件。链接改成指向新的configmap版本。是个独特路径，映射n级后能到configmap存储卷上，所以只要configmap源内容改了，就会同步改掉。<br><img src="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/Kubernetes/158.png" alt=""></p>
<p><strong>【示例5】:演示真正注入Nginx配置文件。</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@spark32 configmap]# kubectl delete -f pod-configmap-volume.yaml </div><div class="line">pod &quot;pod-cm-vol&quot; deleted</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">[root@spark32 configmap]# vim pod-configmap-nginx.yaml </div><div class="line">apiVersion: v1</div><div class="line">kind: Pod</div><div class="line">metadata:</div><div class="line">  name: pod-cm-nginx</div><div class="line">  namespace: default</div><div class="line">  labels:</div><div class="line">    app: myapp</div><div class="line">    tier: frontend</div><div class="line">  annotations:</div><div class="line">    wisedu.com/created-by: &quot;cluster admin&quot;</div><div class="line">spec:</div><div class="line">  containers:</div><div class="line">  - name: myapp</div><div class="line">    image: ikubernetes/myapp:v1</div><div class="line">    ports:</div><div class="line">    - name: http</div><div class="line">      containerPort: 80</div><div class="line">    volumeMounts:</div><div class="line">    - name: nginxconf</div><div class="line">      mountPath: /etc/nginx/conf.d/</div><div class="line">      readOnly: true</div><div class="line">  volumes:</div><div class="line">  - name: nginxconf</div><div class="line">    configMap:</div><div class="line">      name: nginx-www</div></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/Kubernetes/159.png" alt=""><br>如果这个挂载点指定的目录在原来容器中有内容，会被挂载的内容覆盖掉。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">[root@spark32 configmap]# kubectl exec pod-cm-nginx -it -- /bin/sh</div><div class="line">/ # cd /etc/nginx/conf.d</div><div class="line">/etc/nginx/conf.d # ls</div><div class="line">www.conf</div><div class="line">/etc/nginx/conf.d # cat www.conf </div><div class="line">server &#123;</div><div class="line">    server_name myapp.wisedu.com;</div><div class="line">    listen 80;</div><div class="line">    root /data/web/html;</div><div class="line">&#125;</div><div class="line">/etc/nginx/conf.d # mkdir /data/web/html -p</div><div class="line">/etc/nginx/conf.d # vi /data/web/html/index.html</div><div class="line">&lt;h1&gt;Nginx Server configured by CM&lt;/h1&gt;</div></pre></td></tr></table></figure></p>
<p>接下来配置hosts解析：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[root@spark32 configmap]# kubectl get pods -o wide</div><div class="line">...</div><div class="line">pod-cm-nginx                     1/1     Running   0          4m7s   10.244.1.26   spark17    &lt;none&gt;           &lt;none&gt;</div><div class="line">...</div><div class="line">[root@spark32 configmap]# vim /etc/hosts</div><div class="line">10.244.1.26 myapp.wisedu.com</div></pre></td></tr></table></figure></p>
<p>访问：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@spark32 configmap]# curl myapp.wisedu.com</div><div class="line">&lt;h1&gt;Nginx Server configured by CM&lt;/h1&gt;</div></pre></td></tr></table></figure></p>
<p>现在改下外部配置，改下监听端口：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@spark32 configmap]# kubectl edit cm nginx-www</div></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/Kubernetes/160.png" alt=""><br>还是等了10来秒才生效<br><img src="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/Kubernetes/161.png" alt=""><br>访问：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@spark32 configmap]# curl myapp.wisedu.com:8080</div><div class="line">&lt;h1&gt;Nginx Server configured by CM&lt;/h1&gt;</div></pre></td></tr></table></figure></p>
<p>但是刚才挂载的时候，只要configmap有的键，都挂载进去了。如果以存储卷挂载访问configmap时不希望把所有的key都挂载进来，只希望挂载部分key，这也是可以的。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">[root@spark32 configmap]# kubectl explain pods.spec.volumes.configMap</div><div class="line">FIELDS:</div><div class="line">   defaultMode  &lt;integer&gt;</div><div class="line">     Optional: mode bits to use on created files by default. Must be a value</div><div class="line">     between 0 and 0777. Defaults to 0644. Directories within the path are not</div><div class="line">     affected by this setting. This might be in conflict with other options that</div><div class="line">     affect the file mode, like fsGroup, and the result can be other mode bits</div><div class="line">     set.</div><div class="line"></div><div class="line">   items        &lt;[]Object&gt;</div><div class="line">     If unspecified, each key-value pair in the Data field of the referenced</div><div class="line">     ConfigMap will be projected into the volume as a file whose name is the key</div><div class="line">     and content is the value. If specified, the listed keys will be projected</div><div class="line">     into the specified paths, and unlisted keys will not be present. If a key</div><div class="line">     is specified which is not present in the ConfigMap, the volume setup will</div><div class="line">     error unless it is marked optional. Paths must be relative and may not</div><div class="line">     contain the &apos;..&apos; path or start with &apos;..&apos;.</div><div class="line"></div><div class="line">   name &lt;string&gt;</div><div class="line">     Name of the referent. More info:</div><div class="line">     https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names</div><div class="line"></div><div class="line">   optional     &lt;boolean&gt;</div><div class="line">     Specify whether the ConfigMap or it&apos;s keys must be defined</div></pre></td></tr></table></figure></p>
<ul>
<li>itmes: 把name字段指定的configMap中的哪些字段挂载进来</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">[root@spark32 configmap]# kubectl explain pods.spec.volumes.configMap.items</div><div class="line"></div><div class="line">FIELDS:</div><div class="line">   key  &lt;string&gt; -required-</div><div class="line">     The key to project.</div><div class="line"></div><div class="line">   mode &lt;integer&gt;</div><div class="line">     Optional: mode bits to use on this file, must be a value between 0 and</div><div class="line">     0777. If not specified, the volume defaultMode will be used. This might be</div><div class="line">     in conflict with other options that affect the file mode, like fsGroup, and</div><div class="line">     the result can be other mode bits set.</div><div class="line"></div><div class="line">   path &lt;string&gt; -required-</div><div class="line">     The relative path of the file to map the key to. May not be an absolute</div><div class="line">     path. May not contain the path element &apos;..&apos;. May not start with the string</div><div class="line">     &apos;..&apos;.</div></pre></td></tr></table></figure>
<p>列出键的时候，不光要列出键的名字，还要指明真正的文件名(path)，key已经不是默认作为文件名了，是required。文件名和key名一样也可以，但是你需要指定。文件内容就是key所对应的value。挂载的文件可以同时指定文件权限(mode)，path不能使用..，因为..有特殊作用，路径映射方式。</p>
<h2 id="Secret"><a href="#Secret" class="headerlink" title="Secret"></a>Secret</h2><p>configMap存数据是明文的，Secret是base64编码的，但是使用Secret会麻烦一些。只有敏感数据才建议使用secret存放。私钥和证书最好是放在secret中，还有连接mysql时的密码。<br>对于secret而言，它有三种类型：</p>
<ul>
<li>1.generic: Create a secret from a local file, directory or literal value<br>通用的secret，就是里面保存一些密码数据</li>
<li>2.tls: Create a TLS secret<br>私钥和证书。</li>
<li>3.docker-registry: Create a secret for use with a Docker registry<br>保存docker-registry的认证信息。每一个Node在运行Pod之前，它得把Pod所依赖的镜像拉取到本地，需要到某个registry上拉取。如果是去某个私有registry拉取，里面镜像也是私有的，必须要输入账号密码才能访问，账号密码放哪？也就意味着当前的Node要能够自动地认证，并从registry拉取镜像。否则Pod创建肯定是失败。现在是kubelet会认证到私有仓库，然后拉下来进行。<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[root@spark32 configmap]# kubectl explain pods.spec</div><div class="line">   imagePullSecrets     &lt;[]Object&gt;</div><div class="line">     ImagePullSecrets is an optional list of references to secrets in the same</div><div class="line">     namespace to use for pulling any of the images used by this PodSpec. If</div><div class="line">     specified, these secrets will be passed to individual puller</div><div class="line">     implementations for them to use. For example, in the case of docker, only</div><div class="line">     DockerConfig type secrets are honored. More info:</div><div class="line">     https://kubernetes.io/docs/concepts/containers/images#specifying-imagepullsecrets-on-a-pod</div></pre></td></tr></table></figure>
</li>
</ul>
<p>创建secret命令：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">[root@spark32 configmap]# kubectl create secret -h</div><div class="line">Create a secret using specified subcommand.</div><div class="line"></div><div class="line">Available Commands:</div><div class="line">  docker-registry Create a secret for use with a Docker registry</div><div class="line">  generic         Create a secret from a local file, directory or literal value</div><div class="line">  tls             Create a TLS secret</div><div class="line"></div><div class="line">Usage:</div><div class="line">  kubectl create secret [flags] [options]</div><div class="line"></div><div class="line">Use &quot;kubectl &lt;command&gt; --help&quot; for more information about a given command.</div><div class="line">Use &quot;kubectl options&quot; for a list of global command-line options (applies to all commands).</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line">[root@spark32 configmap]# kubectl create secret generic -h</div><div class="line">Create a secret based on a file, directory, or specified literal value.</div><div class="line"></div><div class="line"> A single secret may package one or more key/value pairs.</div><div class="line"></div><div class="line"> When creating a secret based on a file, the key will default to the basename of the file, and the value will default to</div><div class="line">the file content. If the basename is an invalid key or you wish to chose your own, you may specify an alternate key.</div><div class="line"></div><div class="line"> When creating a secret based on a directory, each file whose basename is a valid key in the directory will be packaged</div><div class="line">into the secret. Any directory entries except regular files are ignored (e.g. subdirectories, symlinks, devices, pipes,</div><div class="line">etc).</div><div class="line"></div><div class="line">Examples:</div><div class="line">  # Create a new secret named my-secret with keys for each file in folder bar</div><div class="line">  kubectl create secret generic my-secret --from-file=path/to/bar</div><div class="line">  </div><div class="line">  # Create a new secret named my-secret with specified keys instead of names on disk</div><div class="line">  kubectl create secret generic my-secret --from-file=ssh-privatekey=~/.ssh/id_rsa</div><div class="line">--from-file=ssh-publickey=~/.ssh/id_rsa.pub</div><div class="line">  </div><div class="line">  # Create a new secret named my-secret with key1=supersecret and key2=topsecret</div><div class="line">  kubectl create secret generic my-secret --from-literal=key1=supersecret --from-literal=key2=topsecret</div><div class="line">  </div><div class="line">  # Create a new secret named my-secret using a combination of a file and a literal</div><div class="line">  kubectl create secret generic my-secret --from-file=ssh-privatekey=~/.ssh/id_rsa --from-literal=passphrase=topsecret</div><div class="line">  </div><div class="line">  # Create a new secret named my-secret from an env file</div><div class="line">  kubectl create secret generic my-secret --from-env-file=path/to/bar.env</div><div class="line"></div><div class="line">Options:</div><div class="line">      --allow-missing-template-keys=true: If true, ignore any errors in templates when a field or map key is missing in</div><div class="line">the template. Only applies to golang and jsonpath output formats.</div><div class="line">      --append-hash=false: Append a hash of the secret to its name.</div><div class="line">      --dry-run=false: If true, only print the object that would be sent, without sending it.</div><div class="line">      --from-env-file=&apos;&apos;: Specify the path to a file to read lines of key=val pairs to create a secret (i.e. a Docker</div><div class="line">.env file).</div><div class="line">      --from-file=[]: Key files can be specified using their file path, in which case a default name will be given to</div><div class="line">them, or optionally with a name and file path, in which case the given name will be used.  Specifying a directory will</div><div class="line">iterate each named file in the directory that is a valid secret key.</div><div class="line">      --from-literal=[]: Specify a key and literal value to insert in secret (i.e. mykey=somevalue)</div><div class="line">      --generator=&apos;secret/v1&apos;: The name of the API generator to use.</div><div class="line">  -o, --output=&apos;&apos;: Output format. One of:</div><div class="line">json|yaml|name|go-template|go-template-file|template|templatefile|jsonpath|jsonpath-file.</div><div class="line">      --save-config=false: If true, the configuration of current object will be saved in its annotation. Otherwise, the</div><div class="line">annotation will be unchanged. This flag is useful when you want to perform kubectl apply on this object in the future.</div><div class="line">      --template=&apos;&apos;: Template string or path to template file to use when -o=go-template, -o=go-template-file. The</div><div class="line">template format is golang templates [http://golang.org/pkg/text/template/#pkg-overview].</div><div class="line">      --type=&apos;&apos;: The type of secret to create</div><div class="line">      --validate=true: If true, use a schema to validate the input before sending it</div><div class="line"></div><div class="line">Usage:</div><div class="line">  kubectl create secret generic NAME [--type=string] [--from-file=[key=]source] [--from-literal=key1=value1] [--dry-run]</div><div class="line">[options]</div><div class="line"></div><div class="line">Use &quot;kubectl options&quot; for a list of global command-line options (applies to all commands).</div></pre></td></tr></table></figure>
<p>【示例1】：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[root@spark32 configmap]# kubectl create secret generic mysql-root-passwd --from-literal=password=Mypass@123</div><div class="line">secret/mysql-root-passwd created</div><div class="line">[root@spark32 configmap]# kubectl get secret</div><div class="line">NAME                    TYPE                                  DATA   AGE</div><div class="line">default-token-wb7fl     kubernetes.io/service-account-token   3      138d</div><div class="line">mysql-root-passwd       Opaque                                1      5s</div><div class="line">tomcat-ingress-secret   kubernetes.io/tls                     2      6d22h</div></pre></td></tr></table></figure></p>
<ul>
<li>Opaque: 模糊类型，就是generic类型</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">[root@spark32 configmap]# kubectl describe secret mysql-root-passwd</div><div class="line">Name:         mysql-root-passwd</div><div class="line">Namespace:    default</div><div class="line">Labels:       &lt;none&gt;</div><div class="line">Annotations:  &lt;none&gt;</div><div class="line"></div><div class="line">Type:  Opaque</div><div class="line"></div><div class="line">Data</div><div class="line">====</div><div class="line">password:  10 bytes</div></pre></td></tr></table></figure>
<p>这么看是看不到secret内容的。<br><img src="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/Kubernetes/162.png" alt=""></p>
<p><strong>【示例2】：env方式引用secret中的key</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">[root@spark32 configmap]# vim pod-secret.yaml</div><div class="line">apiVersion: v1</div><div class="line">kind: Pod</div><div class="line">metadata:</div><div class="line">  name: pod-secret-1</div><div class="line">  namespace: default</div><div class="line">  labels:</div><div class="line">    app: myapp</div><div class="line">    tier: frontend</div><div class="line">  annotations:</div><div class="line">    wisedu.com/created-by: &quot;cluster admin&quot;</div><div class="line">spec:</div><div class="line">  containers:</div><div class="line">  - name: myapp</div><div class="line">    image: ikubernetes/myapp:v1</div><div class="line">    ports:</div><div class="line">    - name: http</div><div class="line">      containerPort: 80</div><div class="line">    env:</div><div class="line">    - name: MYSQL_ROOT_PASSWORD</div><div class="line">      valueFrom:</div><div class="line">        secretKeyRef:</div><div class="line">          name: mysql-root-passwd</div><div class="line">          key: password</div><div class="line">[root@spark32 configmap]# kubectl apply -f pod-secret.yaml                                    </div><div class="line">pod/pod-secret-1 created</div><div class="line">[root@spark32 configmap]# kubectl exec pod-secret-1 -it -- printenv | grep MYSQL_ROOT_PASSWORD</div><div class="line">MYSQL_ROOT_PASSWORD=Mypass@123</div></pre></td></tr></table></figure></p>
<p>可见，变量的值是解码以后注入进去的。</p>

      
    </div>

    <div>
      
        
      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Kubernetes/" rel="tag"><i class="fa fa-tag"></i>Kubernetes</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/08/26/Kubernetes存储卷/" rel="next" title="Kubernetes存储卷">
                <i class="fa fa-chevron-left"></i> Kubernetes存储卷
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/08/30/Kubernetes-StatefulSet控制器/" rel="prev" title="Kubernetes StatefulSet控制器">
                Kubernetes StatefulSet控制器 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


      <div id="lv-container" data-id="city" data-uid="MTAyMC8yODkyNi81NDk1"></div>

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="Zhao Jiankai" />
          <p class="site-author-name" itemprop="name">Zhao Jiankai</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">101</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">21</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">28</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/jkzhao" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/3566507667/profile?rightmod=1&wvr=6&mod=personinfo&is_all=1" target="_blank" title="微博">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  微博
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              友情链接
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.importnew.com/" title="ImportNew" target="_blank">ImportNew</a>
                </li>
              
            </ul>
          </div>
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#两种特殊的存储卷-configMap和secret"><span class="nav-number">1.</span> <span class="nav-text">两种特殊的存储卷:configMap和secret</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Pod资源获取环境变量的方式：env、envFrom"><span class="nav-number">2.</span> <span class="nav-text">Pod资源获取环境变量的方式：env、envFrom</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#configMap"><span class="nav-number">3.</span> <span class="nav-text">configMap</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#configMap示例"><span class="nav-number">4.</span> <span class="nav-text">configMap示例</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Secret"><span class="nav-number">5.</span> <span class="nav-text">Secret</span></a></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Zhao Jiankai</span>
</div>

<div class="powered-by">
<i class="fa fa-user-md"></i><span id="busuanzi_container_site_uv">
  本站访客数:<span id="busuanzi_value_site_uv"></span>
</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>

<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共297.9k字</span>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.1"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  



  



  
    <script type="text/javascript">
      (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>
  



  
  
  

  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("r9OTvh5qdm5WfVnhJBm4XoP9-gzGzoHsz", "VAES8qziiwbdUq0IzdQVj5xD");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

<!--    -->
</body>
</html>
