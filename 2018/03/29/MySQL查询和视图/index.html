<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  
    
      
    

    
  

  

  
    
      
    

    
  

  
    
      
    

    
  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Lobster Two:300,300italic,400,400italic,700,700italic|consolas:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="MySQL," />





  <link rel="alternate" href="/atom.xml" title="jkzhao's blog" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico?v=5.0.1" />






<meta name="description" content="查询的执行路径查询执行路径：先查缓存，缓存未命中交给解析器。MySQL是允许多个用户连接进来的，因此有多个线程，如果每个线程上的用户都发起查询请求，而mysql真正能够执行查询的查询引擎只有一个，所以要排队，要给一个队列。">
<meta name="keywords" content="MySQL">
<meta property="og:type" content="article">
<meta property="og:title" content="MySQL查询和视图">
<meta property="og:url" content="http://yoursite.com/2018/03/29/MySQL查询和视图/index.html">
<meta property="og:site_name" content="jkzhao&#39;s blog">
<meta property="og:description" content="查询的执行路径查询执行路径：先查缓存，缓存未命中交给解析器。MySQL是允许多个用户连接进来的，因此有多个线程，如果每个线程上的用户都发起查询请求，而mysql真正能够执行查询的查询引擎只有一个，所以要排队，要给一个队列。">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/25.png">
<meta property="og:image" content="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/26.png">
<meta property="og:image" content="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/27.png">
<meta property="og:image" content="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/28.png">
<meta property="og:image" content="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/29.png">
<meta property="og:image" content="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/30.png">
<meta property="og:image" content="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/31.png">
<meta property="og:image" content="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/32.png">
<meta property="og:image" content="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/33.png">
<meta property="og:image" content="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/34.png">
<meta property="og:image" content="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/35.png">
<meta property="og:image" content="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/36.png">
<meta property="og:image" content="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/37.png">
<meta property="og:image" content="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/38.png">
<meta property="og:image" content="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/39.png">
<meta property="og:image" content="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/40.png">
<meta property="og:image" content="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/41.png">
<meta property="og:image" content="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/42.png">
<meta property="og:image" content="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/43.png">
<meta property="og:image" content="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/44.png">
<meta property="og:image" content="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/45.png">
<meta property="og:image" content="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/46.png">
<meta property="og:image" content="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/47.png">
<meta property="og:image" content="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/48.png">
<meta property="og:image" content="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/49.png">
<meta property="og:image" content="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/50.png">
<meta property="og:image" content="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/51.png">
<meta property="og:image" content="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/52.png">
<meta property="og:image" content="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/53.png">
<meta property="og:image" content="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/54.png">
<meta property="og:image" content="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/55.png">
<meta property="og:image" content="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/56.png">
<meta property="og:image" content="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/57.png">
<meta property="og:image" content="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/58.png">
<meta property="og:image" content="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/59.png">
<meta property="og:image" content="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/60.png">
<meta property="og:image" content="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/61.png">
<meta property="og:updated_time" content="2018-04-03T06:23:16.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="MySQL查询和视图">
<meta name="twitter:description" content="查询的执行路径查询执行路径：先查缓存，缓存未命中交给解析器。MySQL是允许多个用户连接进来的，因此有多个线程，如果每个线程上的用户都发起查询请求，而mysql真正能够执行查询的查询引擎只有一个，所以要排队，要给一个队列。">
<meta name="twitter:image" content="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/25.png">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 6287775856811050000,
      author: 'Author'
    }
  };
</script>

  <title> MySQL查询和视图 | jkzhao's blog </title>
</head>
<a href="https://github.com/you"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/38ef81f8aca64bb9a64448d0d70f1308ef5341ab/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6461726b626c75655f3132313632312e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"></a>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?c179eb46ac47d3b4b1b9203b82ee5821";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>








  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <a href="https://github.com/jkzhao"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/38ef81f8aca64bb9a64448d0d70f1308ef5341ab/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6461726b626c75655f3132313632312e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"></a>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">jkzhao's blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">学习 总结 思考</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-guestbook">
          <a href="/guestbook" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            留言
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="#" class="st-search-show-outputs">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <form class="site-search-form">
  <input type="text" id="st-search-input" class="st-search-input st-default-search-input" />
</form>

<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
    (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
    e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install', 'CziK4aDdRyzFJrfygnHH','2.0.0');
</script>



    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                MySQL查询和视图
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2018-03-29T09:20:40+08:00" content="2018-03-29">
              2018-03-29
            </time>
            
              <span class="post-updated">
              &nbsp; | &nbsp; 更新于
              <time itemprop="dateUpdated" datetime="2018-04-03T14:23:16+08:00" content="2018-04-03">
              2018-04-03
              </time>
              </span>
            
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/MySQL/" itemprop="url" rel="index">
                    <span itemprop="name">MySQL</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          
             <span id="/2018/03/29/MySQL查询和视图/" class="leancloud_visitors" data-flag-title="MySQL查询和视图">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="查询的执行路径"><a href="#查询的执行路径" class="headerlink" title="查询的执行路径"></a>查询的执行路径</h2><p><strong>查询执行路径：</strong>先查缓存，缓存未命中交给解析器。MySQL是允许多个用户连接进来的，因此有多个线程，如果每个线程上的用户都发起查询请求，而mysql真正能够执行查询的查询引擎只有一个，所以要排队，要给一个队列。<a id="more"></a>所以就需要有查询执行计划和查询执行引擎。但是查询执行引擎不能直接去硬盘取数据，所以查询引擎是接收查询执行计划传递而来的优化器优化后的查询语句，它负责转换为对应表的存储引擎的API调用。后面的数据获取是由对应的存储引擎负责到磁盘上取数据，并将数据返回给执行引擎，最后在层层返回给客户端，返回客户端之前有可能要判断要不要缓存下来。比如查当前系统时间，这个就没必要缓存下来了。查询的结果缓存与否，用户是可以定义的。当然不是说用户想缓存就一定能缓存。<br><img src="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/25.png" alt=""></p>
<h2 id="MySQL的查询操作"><a href="#MySQL的查询操作" class="headerlink" title="MySQL的查询操作"></a>MySQL的查询操作</h2><p>使用SELECT语句查询数据，查询语句的通用语法格式：</p>
<pre><code>SELECT values_to_dispaly
FROM table_name 
WHERE expression
GROUP BY how_to_group
HAVING expression
ORDER BY how_to_sort
LIMIT row_count;
</code></pre><p>查询又可分为：</p>
<ul>
<li>单表查询：也称为简单查询</li>
<li>多表查询：也称为连接查询</li>
<li>联合查询</li>
</ul>
<p>选择和投影：就是关系代数，其实SELECT主要就包括这两方面</p>
<ul>
<li>投影：挑选要显示的字段</li>
<li>选择：挑选符合条件的行<ul>
<li>投影：SELECT 字段1, 字段2, … FROM tb_name; <ul>
<li>SELECT * FROM tb_name;</li>
</ul>
</li>
<li>选择：SELECT 字段1, … FROM tb_name WHERE 子句; <ul>
<li>WHERE 子句就是布尔条件表达式</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="WHERE子句"><a href="#WHERE子句" class="headerlink" title="WHERE子句"></a>WHERE子句</h3><p>HERE 子句就是布尔条件表达式</p>
<ul>
<li><p>布尔条件表达式操作符： </p>
<ul>
<li>=</li>
<li>&lt;=&gt; ：空值安全比较。与空比较值的安全方式，跟空值比较不会产生意外情况的等值比较。和上面那个一样都是等值比较。</li>
<li>&lt;&gt; ：不等于</li>
<li>&lt;</li>
<li>&lt;=</li>
<li>&gt;</li>
<li><blockquote>
<p>=</p>
</blockquote>
</li>
<li><p>IS NULL ：判断一个字段的值是否为空。</p>
</li>
<li><p>IS NOT NULL</p>
</li>
<li><p>LIKE: 支持的通配符: %(任意长度的任意字符)， _（任意单个字符） 。<br>【注意】:能用等值比较或不等值比较，就尽量不要用LIKE。因为它的性能要差得多。</p>
</li>
<li><p>RLIKE(REGEXP): 支持使用正则表达式 。<br>【注意】:性能比较低。LIKE和RLIKE是用来做字符串比较的，千万不要拿来做数值比较。</p>
</li>
<li><p>IN: 判断指定字段的值是否在给定在列表中。</p>
</li>
<li><p>BETWEEN … AND …: 位于指定的范围之间 。</p>
</li>
</ul>
</li>
</ul>
<p><strong>【示例1】：NULL示例</strong></p>
<pre><code>mysql&gt; CREATE TABLE `students` (`SID` int(100), `Name` varchar(50) NOT NULL, `Age` TINYINT UNSIGNED NOT NULL, `Gender` ENUM(&apos;M&apos;,&apos;F&apos;) NOT NULL DEFAULT &apos;M&apos;, `Tutor` varchar(50), PRIMARY KEY(`SID`));
Query OK, 0 rows affected (0.04 sec)

mysql&gt; INSERT INTO `students` VALUES (1,&apos;tom&apos;,13,&apos;M&apos;,&apos;Song Jiang&apos;);
Query OK, 1 row affected (0.00 sec)

mysql&gt; INSERT INTO `students` VALUES (2,&apos;jerry&apos;,14,&apos;F&apos;,&apos;Jiabaoyu&apos;); 
Query OK, 1 row affected (0.01 sec)

mysql&gt; INSERT INTO `students` VALUES (3,&apos;jack&apos;,14,&apos;M&apos;,&apos;JinJiao&apos;);
Query OK, 1 row affected (0.01 sec)

mysql&gt; INSERT INTO `students` VALUES (4,&apos;Lucy&apos;,14,&apos;F&apos;,NULL);
Query OK, 1 row affected (0.00 sec)
</code></pre><p><img src="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/26.png" alt=""></p>
<p><strong>【示例2】：LIKE示例</strong><br><img src="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/27.png" alt=""></p>
<p><strong>【示例3】：RLIKE示例</strong><br><img src="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/28.png" alt=""></p>
<p><strong>【示例4】：IN示例</strong><br><img src="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/29.png" alt=""></p>
<p><strong>【示例5】：BETWEEN … AND示例</strong><br><img src="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/30.png" alt=""></p>
<p>组合条件测试： 逻辑操作符组合多个条件。</p>
<ul>
<li>NOT, 可以用 ! 表示。</li>
<li>AND, 可以用&amp;&amp;表示</li>
<li>OR, 可以用 || 表示</li>
</ul>
<h3 id="聚合函数"><a href="#聚合函数" class="headerlink" title="聚合函数"></a>聚合函数</h3><p>聚合函数是mysql内置的。<br><strong>SUM(), AVG(), MAX(), MIN(), COUNT()</strong><br><img src="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/31.png" alt=""><br><img src="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/32.png" alt=""></p>
<h3 id="分组"><a href="#分组" class="headerlink" title="分组"></a>分组</h3><p><strong>GROUP BY</strong>。在聚合函数使用时，往往伴随着分组的使用，然后对一组进行聚合。分组的目的主要是来用聚合。我们可以在GROUP BY之前使用WHERE子句做条件过滤。具体前面写的通用查询格式。<br><img src="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/33.png" alt=""></p>
<h3 id="HAVING子句"><a href="#HAVING子句" class="headerlink" title="HAVING子句"></a>HAVING子句</h3><p>对GROUP BY、聚合函数查出的结果做条件过滤用HAVING子句。</p>
<pre><code>mysql&gt; ALTER TABLE students ADD column `ClassID` int(10);
Query OK, 0 rows affected (0.05 sec)
Records: 0  Duplicates: 0  Warnings: 0

mysql&gt; UPDATE students SET ClassID=1 WHERE Name=&apos;Tom&apos;;
Query OK, 1 row affected (0.00 sec)
Rows matched: 1  Changed: 1  Warnings: 0

mysql&gt; UPDATE students SET ClassID=1 WHERE Name=&apos;Jerry&apos;;
Query OK, 1 row affected (0.00 sec)
Rows matched: 1  Changed: 1  Warnings: 0

mysql&gt; UPDATE students SET ClassID=1 WHERE Name=&apos;Jack&apos;;
Query OK, 1 row affected (0.01 sec)
Rows matched: 1  Changed: 1  Warnings: 0

mysql&gt; UPDATE students SET ClassID=2 WHERE Name=&apos;Lucy&apos;;
Query OK, 1 row affected (0.01 sec)
Rows matched: 1  Changed: 1  Warnings: 0
</code></pre><p><img src="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/34.png" alt=""></p>
<h3 id="排序"><a href="#排序" class="headerlink" title="排序"></a>排序</h3><p><strong>ORDER BY。</strong><br><img src="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/35.png" alt=""></p>
<h3 id="LIMIT"><a href="#LIMIT" class="headerlink" title="LIMIT"></a>LIMIT</h3><p><strong>【注意】:有的时候为了简单的判断工作，我们只需要查询结果返回一部分结果，这时候可以使用LIMIT子句。</strong><br><img src="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/36.png" alt=""></p>
<h3 id="总结SELECT几种惯常用法"><a href="#总结SELECT几种惯常用法" class="headerlink" title="总结SELECT几种惯常用法"></a>总结SELECT几种惯常用法</h3><pre><code>SELECT ...
FROM ...
ORDER BY ...

SELECT ...
FROM ...
GROUP BY ...
HAVING ...

SELECT ...
FROM ...
WHERE ...

SELECT ...

SELECT ...
FROM ...
WHERE ...
GROUP BY ...
LIMIT ...

SELECT ...
FROM ...
HAVING ...
</code></pre><h3 id="SELECT语句的执行流程"><a href="#SELECT语句的执行流程" class="headerlink" title="SELECT语句的执行流程"></a>SELECT语句的执行流程</h3><pre><code>FROM clause --&gt; WHERE clause --&gt; GROUP BY --&gt; HAVING clause --&gt; ORDER BY ... --&gt; SELECT --&gt; LIMIT
</code></pre><p><strong>【注意】:where子句不能使用聚合函数</strong><br><img src="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/37.png" alt=""></p>
<p>【补充】：SELECT语句:</p>
<ul>
<li>DISTINCT：指定的结果相同的只显示一次；</li>
<li>SQL_CACHE：缓存于查询缓存中；</li>
<li>SQL_NO_CACHE：不缓存查询结果。<br><img src="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/38.png" alt=""></li>
</ul>
<h2 id="多表查询"><a href="#多表查询" class="headerlink" title="多表查询"></a>多表查询</h2><p>联结查询：事先将两张或多张表join，根据join的结果进行查询。<br>为什么会有多表查询？数据库设计要求降低冗余。如果一个数据我们来回存了n次，就建议拆分成两张表，并且在两张表中都有的字段建立关联关系。</p>
<p>下面先初始化数据，导入一个sql脚本，用于举例子。脚本内容如下：</p>
<pre><code>CREATE DATABASE /*!32312 IF NOT EXISTS*/ `test` /*!40100 DEFAULT CHARACTER SET utf8 */;

USE `test`;

--
-- Table structure for table `classes`
--

DROP TABLE IF EXISTS `classes`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `classes` (
  `ClassID` tinyint(3) unsigned NOT NULL AUTO_INCREMENT,
  `Class` varchar(100) DEFAULT NULL,
  `NumOfStu` smallint(5) unsigned DEFAULT NULL,
  PRIMARY KEY (`ClassID`)
) ENGINE=MyISAM AUTO_INCREMENT=9 DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `classes`
--

LOCK TABLES `classes` WRITE;
/*!40000 ALTER TABLE `classes` DISABLE KEYS */;
INSERT INTO `classes` VALUES (1,&apos;Shaolin Pai&apos;,10),(2,&apos;Emei Pai&apos;,7),(3,&apos;QingCheng Pai&apos;,11),(4,&apos;Wudang Pai&apos;,12),(5,&apos;Riyue Shenjiao&apos;,31),(6,&apos;Lianshan Pai&apos;,27),(7,&apos;Ming Jiao&apos;,27),(8,&apos;Xiaoyao Pai&apos;,15);
/*!40000 ALTER TABLE `classes` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `coc`
--

DROP TABLE IF EXISTS `coc`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `coc` (
  `ID` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `ClassID` tinyint(3) unsigned NOT NULL,
  `CourseID` smallint(5) unsigned DEFAULT NULL,
  PRIMARY KEY (`ID`)
) ENGINE=MyISAM AUTO_INCREMENT=15 DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `coc`
--

LOCK TABLES `coc` WRITE;
/*!40000 ALTER TABLE `coc` DISABLE KEYS */;
INSERT INTO `coc` VALUES (1,1,2),(2,1,5),(3,2,2),(4,2,6),(5,3,1),(6,3,7),(7,4,5),(8,4,2),(9,5,1),(10,5,9),(11,6,3),(12,6,4),(13,7,4),(14,7,3);
/*!40000 ALTER TABLE `coc` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `courses`
--

DROP TABLE IF EXISTS `courses`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `courses` (
  `CourseID` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `Course` varchar(100) NOT NULL,
  PRIMARY KEY (`CourseID`)
) ENGINE=MyISAM AUTO_INCREMENT=8 DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `courses`
--

LOCK TABLES `courses` WRITE;
/*!40000 ALTER TABLE `courses` DISABLE KEYS */;
INSERT INTO `courses` VALUES (1,&apos;Hamo Gong&apos;),(2,&apos;Kuihua Baodian&apos;),(3,&apos;Jinshe Jianfa&apos;),(4,&apos;Taiji Quan&apos;),(5,&apos;Daiyu Zanghua&apos;),(6,&apos;Weituo Zhang&apos;),(7,&apos;Dagou Bangfa&apos;);
/*!40000 ALTER TABLE `courses` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `scores`
--

DROP TABLE IF EXISTS `scores`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `scores` (
  `ID` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `StuID` int(10) unsigned NOT NULL,
  `CourseID` smallint(5) unsigned NOT NULL,
  `Score` tinyint(3) unsigned DEFAULT NULL,
  PRIMARY KEY (`ID`)
) ENGINE=MyISAM AUTO_INCREMENT=16 DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `scores`
--

LOCK TABLES `scores` WRITE;
/*!40000 ALTER TABLE `scores` DISABLE KEYS */;
INSERT INTO `scores` VALUES (1,1,2,77),(2,1,6,93),(3,2,2,47),(4,2,5,97),(5,3,2,88),(6,3,6,75),(7,4,5,71),(8,4,2,89),(9,5,1,39),(10,5,7,63),(11,6,1,96),(12,7,1,86),(13,7,7,83),(14,8,4,57),(15,8,3,93);
/*!40000 ALTER TABLE `scores` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `students`
--

DROP TABLE IF EXISTS `students`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `students` (
  `StuID` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Name` varchar(50) NOT NULL,
  `Age` tinyint(3) unsigned NOT NULL,
  `Gender` enum(&apos;F&apos;,&apos;M&apos;) NOT NULL,
  `ClassID` tinyint(3) unsigned DEFAULT NULL,
  `TeacherID` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`StuID`)
) ENGINE=MyISAM AUTO_INCREMENT=26 DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `students`
--

LOCK TABLES `students` WRITE;
/*!40000 ALTER TABLE `students` DISABLE KEYS */;
INSERT INTO `students` VALUES (1,&apos;Shi Zhongyu&apos;,22,&apos;M&apos;,2,3),(2,&apos;Shi Potian&apos;,22,&apos;M&apos;,1,7),(3,&apos;Xie Yanke&apos;,53,&apos;M&apos;,2,16),(4,&apos;Ding Dian&apos;,32,&apos;M&apos;,4,4),(5,&apos;Yu Yutong&apos;,26,&apos;M&apos;,3,1),(6,&apos;Shi Qing&apos;,46,&apos;M&apos;,5,NULL),(7,&apos;Xi Ren&apos;,19,&apos;F&apos;,3,NULL),(8,&apos;Lin Daiyu&apos;,17,&apos;F&apos;,7,NULL),(9,&apos;Ren Yingying&apos;,20,&apos;F&apos;,6,NULL),(10,&apos;Yue Lingshan&apos;,19,&apos;F&apos;,3,NULL),(11,&apos;Yuan Chengzhi&apos;,23,&apos;M&apos;,6,NULL),(12,&apos;Wen Qingqing&apos;,19,&apos;F&apos;,1,NULL),(13,&apos;Tian Boguang&apos;,33,&apos;M&apos;,2,NULL),(14,&apos;Lu Wushuang&apos;,17,&apos;F&apos;,3,NULL),(15,&apos;Duan Yu&apos;,19,&apos;M&apos;,4,NULL),(16,&apos;Xu Zhu&apos;,21,&apos;M&apos;,1,NULL),(17,&apos;Lin Chong&apos;,25,&apos;M&apos;,4,NULL),(18,&apos;Hua Rong&apos;,23,&apos;M&apos;,7,NULL),(19,&apos;Xue Baochai&apos;,18,&apos;F&apos;,6,NULL),(20,&apos;Diao Chan&apos;,19,&apos;F&apos;,7,NULL),(21,&apos;Huang Yueying&apos;,22,&apos;F&apos;,6,NULL),(22,&apos;Xiao Qiao&apos;,20,&apos;F&apos;,1,NULL),(23,&apos;Ma Chao&apos;,23,&apos;M&apos;,4,NULL),(24,&apos;Xu Xian&apos;,27,&apos;M&apos;,NULL,NULL),(25,&apos;Sun Dasheng&apos;,100,&apos;M&apos;,NULL,NULL);
/*!40000 ALTER TABLE `students` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `teachers`
--

DROP TABLE IF EXISTS `teachers`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `teachers` (
  `TID` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `Name` varchar(100) NOT NULL,
  `Age` tinyint(3) unsigned NOT NULL,
  `Gender` enum(&apos;F&apos;,&apos;M&apos;) DEFAULT NULL,
  PRIMARY KEY (`TID`)
) ENGINE=MyISAM AUTO_INCREMENT=5 DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `teachers`
--

LOCK TABLES `teachers` WRITE;
/*!40000 ALTER TABLE `teachers` DISABLE KEYS */;
INSERT INTO `teachers` VALUES (1,&apos;Song Jiang&apos;,45,&apos;M&apos;),(2,&apos;Zhang Sanfeng&apos;,94,&apos;M&apos;),(3,&apos;Miejue Shitai&apos;,77,&apos;F&apos;),(4,&apos;Lin Chaoying&apos;,93,&apos;F&apos;);
/*!40000 ALTER TABLE `teachers` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `toc`
--

DROP TABLE IF EXISTS `toc`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `toc` (
  `ID` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `CourseID` smallint(5) unsigned DEFAULT NULL,
  `TID` smallint(5) unsigned DEFAULT NULL,
  PRIMARY KEY (`ID`)
) ENGINE=MyISAM DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `toc`
--

LOCK TABLES `toc` WRITE;
/*!40000 ALTER TABLE `toc` DISABLE KEYS */;
/*!40000 ALTER TABLE `toc` ENABLE KEYS */;
UNLOCK TABLES;
</code></pre><p><strong>join的方式：</strong><br><strong>1.cross join: 交叉联结。多项式相乘。效率极低，很少用。</strong><br>(a+b)(c+d+e)=ac+ad+ae+bc+bd+be</p>
<p><strong>2.自然联结：内连接，等值连接。</strong><br>等值连接:</p>
<pre><code>mysql&gt; SELECT * FROM students, classes WHERE students.ClassID = classes.ClassID;
</code></pre><p><img src="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/39.png" alt=""></p>
<p><strong>3.外联结：</strong></p>
<ul>
<li>左外联结：只保留出现在左外连接运算之前（左边）的关系中的元组(元组就是记录)；<br>left_tb LEFT JOIN right_tb ON 连接条件(通常是一种等值比较)</li>
<li>右外联结：只保留出现在右外连接运算之后（右边）的关系中的元组；left_tb RIGHT JOIN right_tb ON 连接条件</li>
<li>全外联结：左右都出现，保留关系中的每一个元组。对应于右外连接来讲，左侧没有的左侧留空；对应于左外链接来讲，右侧没有的右留空。但是mysql是不支持全外联结。</li>
</ul>
<p>【示例】：左外连接</p>
<pre><code>mysql&gt; SELECT s.Name,c.Class FROM students AS s LEFT JOIN classes AS c ON s.ClassID=c.ClassID;
</code></pre><p><img src="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/40.png" alt=""></p>
<p>【示例】：右外连接</p>
<pre><code>mysql&gt; SELECT s.Name,c.Class FROM students AS s RIGHT JOIN classes AS c ON s.ClassID=c.ClassID;
</code></pre><p><img src="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/41.png" alt=""></p>
<p><strong>4.自联结：自己连接自己。</strong></p>
<pre><code>mysql&gt; SELECT t.Name,s.Name FROM students AS s,students AS t WHERE s.StuID = t.TeacherID;
</code></pre><p><img src="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/42.png" alt=""></p>
<p><strong>别名：</strong>当表名、字段名太长时，或者为了区分，可以起个别名。使用AS<br><img src="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/43.png" alt=""><br><img src="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/44.png" alt=""><br><img src="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/45.png" alt=""></p>
<p><strong>【示例】：</strong><br> 1、显示前5位同学的姓名、课程及成绩；</p>
<pre><code>mysql&gt; SELECT Name,Course FROM students AS s,courses AS c,coc WHERE s.ClassID = coc.ClassID AND coc.CourseID = c.CourseID AND s.StuID &lt; 5;
</code></pre><p><img src="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/46.png" alt=""></p>
<pre><code>mysql&gt; SELECT Name,Course,Score FROM students AS s,courses AS c,coc,scores AS ss WHERE s.ClassID = coc.ClassID AND coc.CourseID = c.CourseID AND s.StuID &lt; 5 AND s.StuID=ss.StuID;
</code></pre><p><img src="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/47.png" alt=""><br>但是由于scores表的StuID有重复，导致上面的s.StuID=ss.StuID条件挑选出来有重复，所以还要加一个条件。</p>
<pre><code>mysql&gt; SELECT Name,Course,Score FROM students AS s,courses AS c,coc,scores AS ss WHERE s.ClassID = coc.ClassID AND coc.CourseID = c.CourseID AND s.StuID &lt; 5 AND s.StuID=ss.StuID AND coc.CourseID=ss.CourseID;
</code></pre><p><img src="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/48.png" alt=""></p>
<p>2、求前8位同学每位同学自己两门课的平均成绩，并按降序排列；</p>
<pre><code>mysql&gt; SELECT Name,AVG(Score) FROM students AS s,courses AS c,coc,scores AS ss WHERE s.ClassID = coc.ClassID AND coc.CourseID = c.CourseID AND s.StuID&lt;=8 AND s.StuID=ss.StuID AND coc.CourseID=ss.CourseID GROUP BY Name ORDER BY AVG(Score) DESC;
</code></pre><p><img src="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/49.png" alt=""></p>
<h2 id="子查询"><a href="#子查询" class="headerlink" title="子查询"></a>子查询</h2><p>【思考】：如何显示其年龄大于平均年龄的同学的名字？<br><img src="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/50.png" alt=""><br>子查询：在查询中嵌套的查询。</p>
<h3 id="用于WHERE中的子查询"><a href="#用于WHERE中的子查询" class="headerlink" title="用于WHERE中的子查询"></a>用于WHERE中的子查询</h3><p><strong>1、用于比较表达式中的子查询</strong><br>子查询的返回值只能有一个；</p>
<pre><code>mysql&gt; SELECT Name,Age FROM students WHERE Age &gt; (SELECT AVG(Age) FROM students GROUP BY Gender); 
ERROR 1242 (21000): Subquery returns more than 1 row
</code></pre><p><strong>2、用于EXISTS中的子查询</strong><br>判断存在与否</p>
<p><strong>3、用于IN中的子查询</strong><br>判断存在于指定列表中</p>
<h3 id="用于FROM中的子查询"><a href="#用于FROM中的子查询" class="headerlink" title="用于FROM中的子查询"></a>用于FROM中的子查询</h3><pre><code>SELECT alias.col,... FROM (SELECT clause) AS alias WHERE condition  
mysql&gt; SELECT s.Name,s.Age,s.Gender FROM (SELECT * FROM students WHERE Gender=&apos;M&apos;) AS s WHERE s.Age &gt; 25;
</code></pre><p><img src="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/51.png" alt=""></p>
<p><strong>【注意】：MySQL不擅长于子查询：应该避免使用子查询。</strong></p>
<p><strong>【总结】：MySQL的联结查询及子查询</strong></p>
<ul>
<li><p>联结</p>
<ul>
<li>交叉联结</li>
<li>内联结</li>
<li>外联结<ul>
<li>左外</li>
<li>右外</li>
</ul>
</li>
<li>自联结</li>
</ul>
</li>
<li><p>子查询</p>
<ul>
<li>用于WHERE中的子查询<ul>
<li>用于条件比较：子查询只能一个值</li>
<li>用于IN：子查询可以返回多个值</li>
<li>EXISTS：子查询可以返回多个值</li>
</ul>
</li>
<li>用于FROM子句的子查询</li>
</ul>
</li>
</ul>
<h2 id="MySQL的联合查询"><a href="#MySQL的联合查询" class="headerlink" title="MySQL的联合查询"></a>MySQL的联合查询</h2><p>把两个或多个查询语句的结果合并成一个结果进行输出。</p>
<pre><code>SELECT clauase UNION SELECT clause UNION ...
</code></pre><p>【示例】：</p>
<pre><code>mysql&gt; SELECT Name,Age FROM teachers UNION SELECT Name,Age FROM students;
</code></pre><p>所谓索引有用，就是查询条件上面有索引，比如下例，你在姓名上创建索引，根据年龄来查找是没用的。</p>
<pre><code>mysql&gt; SELECT Name,Age FROM students WHERE Age &gt; 25;
</code></pre><p>查询表中是否有索引：<br><img src="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/52.png" alt=""></p>
<p>查看一个查询语句是否用到索引：</p>
<pre><code>mysql&gt; EXPLAIN SELECT Name,Age FROM students WHERE Age &gt; 25\G
</code></pre><p><img src="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/53.png" alt=""></p>
<p>在某个字段上添加一个索引，然后再来查看这个查询是否用到索引：</p>
<pre><code>mysql&gt; ALTER TABLE students ADD INDEX (Age);
mysql&gt; SHOW INDEXES FROM students;
mysql&gt; EXPLAIN SELECT Name,Age FROM students WHERE Age &gt; 25\G
</code></pre><p><img src="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/54.png" alt=""></p>
<h2 id="MySQL视图"><a href="#MySQL视图" class="headerlink" title="MySQL视图"></a>MySQL视图</h2><p>视图就是一虚表，MySQL对视图的支持很有限，因为MySQL支持子查询很有限。</p>
<p>【示例】：</p>
<pre><code>mysql&gt; GRANT ALL on hellodb.students TO &apos;testuser&apos;@&apos;172.%.%.%&apos; IDENTIFIED BY &apos;testpass&apos;;
Query OK, 0 rows affected (0.00 sec)
mysql&gt; GRANT ALL on hellodb.students TO &apos;testuser&apos;@&apos;localhost&apos; IDENTIFIED BY &apos;testpass&apos;;          
Query OK, 0 rows affected (0.00 sec)
mysql&gt; FLUSH PRIVILEGES;
Query OK, 0 rows affected (0.00 sec)
</code></pre><p><img src="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/55.png" alt=""><br>为什么会出现这样的情况？</p>
<pre><code>In many default installations, all users have all privileges on tables within any database called test or beginning with test_.
</code></pre><p>所以我这边重新导入上面的数据，并将数据库名字命名为hellodb。然后删除上面的两个用户，并且重新授权。</p>
<pre><code>mysql&gt; use mysql
Database changed
mysql&gt; DELETE FROM user WHERE user=&apos;testuser&apos;;
Query OK, 2 rows affected (0.00 sec)

mysql&gt; FLUSH PRIVILEGES;
Query OK, 0 rows affected (0.00 sec)

mysql&gt; GRANT ALL on hellodb.students TO &apos;testuser&apos;@&apos;172.%.%.%&apos; IDENTIFIED BY &apos;testpass&apos;;
Query OK, 0 rows affected (0.01 sec)

mysql&gt; GRANT ALL on hellodb.students TO &apos;testuser&apos;@&apos;localhost&apos; IDENTIFIED BY &apos;testpass&apos;; 
Query OK, 0 rows affected (0.00 sec)

mysql&gt; FLUSH PRIVILEGES;
Query OK, 0 rows affected (0.00 sec)
</code></pre><p><img src="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/56.png" alt=""><br><img src="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/57.png" alt=""></p>
<p>其实授权的时候可以指定只给看表的某几个字段，但是用户用DESC students还是能看到这两个字段的定义。所以如果我们要想让用户意识到这两个用户不存在怎么办？这就是视图的意义了。创建一个虚表。授权视图给用户。</p>
<p><strong>视图：存储下来的SELECT语句； 说白了就是把SELECT语句当表来用。</strong><br>【注意】:你什么时候用，它什么时候才执行，平时是没有的。因为存下来的是SELECT语句，不是SELECT查询的结果。当然，Oracle支持物化视图，MySQL不支持。</p>
<pre><code>mysql&gt; HELP CREATE VIEW
Name: &apos;CREATE VIEW&apos;
Description:
Syntax:
CREATE
    [OR REPLACE]
    [ALGORITHM = {UNDEFINED | MERGE | TEMPTABLE}]
    [DEFINER = { user | CURRENT_USER }]
    [SQL SECURITY { DEFINER | INVOKER }]
    VIEW view_name [(column_list)]
    AS select_statement
    [WITH [CASCADED | LOCAL] CHECK OPTION]
</code></pre><p><img src="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/58.png" alt=""><br><img src="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/59.png" alt=""><br><img src="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/60.png" alt=""><br><img src="https://raw.githubusercontent.com/jkzhao/MarkdownPictures/master/MySQL/61.png" alt=""></p>
<p>删除视图：</p>
<pre><code>mysql&gt; DROP VIEW stu;
Query OK, 0 rows affected (0.00 sec)
</code></pre>
      
    </div>

    <div>
      
        
      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/MySQL/" rel="tag"><i class="fa fa-tag"></i>MySQL</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/03/26/MySQL数据库及表管理/" rel="next" title="MySQL数据库及表管理">
                <i class="fa fa-chevron-left"></i> MySQL数据库及表管理
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/04/02/MySQL-DML/" rel="prev" title="MySQL DML">
                MySQL DML <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


      <div id="lv-container" data-id="city" data-uid="MTAyMC8yODkyNi81NDk1"></div>

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="Zhao Jiankai" />
          <p class="site-author-name" itemprop="name">Zhao Jiankai</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">100</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">21</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">28</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/jkzhao" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/3566507667/profile?rightmod=1&wvr=6&mod=personinfo&is_all=1" target="_blank" title="微博">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  微博
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              友情链接
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.importnew.com/" title="ImportNew" target="_blank">ImportNew</a>
                </li>
              
            </ul>
          </div>
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#查询的执行路径"><span class="nav-number">1.</span> <span class="nav-text">查询的执行路径</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MySQL的查询操作"><span class="nav-number">2.</span> <span class="nav-text">MySQL的查询操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#WHERE子句"><span class="nav-number">2.1.</span> <span class="nav-text">WHERE子句</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#聚合函数"><span class="nav-number">2.2.</span> <span class="nav-text">聚合函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#分组"><span class="nav-number">2.3.</span> <span class="nav-text">分组</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HAVING子句"><span class="nav-number">2.4.</span> <span class="nav-text">HAVING子句</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#排序"><span class="nav-number">2.5.</span> <span class="nav-text">排序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#LIMIT"><span class="nav-number">2.6.</span> <span class="nav-text">LIMIT</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#总结SELECT几种惯常用法"><span class="nav-number">2.7.</span> <span class="nav-text">总结SELECT几种惯常用法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SELECT语句的执行流程"><span class="nav-number">2.8.</span> <span class="nav-text">SELECT语句的执行流程</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#多表查询"><span class="nav-number">3.</span> <span class="nav-text">多表查询</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#子查询"><span class="nav-number">4.</span> <span class="nav-text">子查询</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#用于WHERE中的子查询"><span class="nav-number">4.1.</span> <span class="nav-text">用于WHERE中的子查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#用于FROM中的子查询"><span class="nav-number">4.2.</span> <span class="nav-text">用于FROM中的子查询</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MySQL的联合查询"><span class="nav-number">5.</span> <span class="nav-text">MySQL的联合查询</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MySQL视图"><span class="nav-number">6.</span> <span class="nav-text">MySQL视图</span></a></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Zhao Jiankai</span>
</div>

<div class="powered-by">
<i class="fa fa-user-md"></i><span id="busuanzi_container_site_uv">
  本站访客数:<span id="busuanzi_value_site_uv"></span>
</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>

<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共291.6k字</span>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.1"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  



  



  
    <script type="text/javascript">
      (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>
  



  
  
  

  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("r9OTvh5qdm5WfVnhJBm4XoP9-gzGzoHsz", "VAES8qziiwbdUq0IzdQVj5xD");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

<!--    -->
</body>
</html>
